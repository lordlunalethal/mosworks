<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Streamlab - Video Streaming HTML5 Template" />
    <meta name="description" content="Streamlab - Video Streaming HTML5 Template" />
    <meta name="author" content="StreamLab" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>mosworks! - Catch up with all your favorite characters!</title>
    <!-- Favicon -->
    <link rel="shortcut icon" href="images/favicon.png">
    <!-- CSS bootstrap-->
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <!--  Style -->
    <link rel="stylesheet" href="css/style.css" />
    <!--  Responsive -->
    <link rel="stylesheet" href="css/responsive.css" />
    <!-- Font Awesome for social icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>

    <!-- Your Firebase Config -->
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyBxn7hOX7k6L-CUgAzA_VzjECxeCCMbiV4",
        authDomain: "mosworks-7bc44.firebaseapp.com",
        projectId: "mosworks-7bc44",
        storageBucket: "mosworks-7bc44.firebasestorage.app",
        messagingSenderId: "788454456705",
        appId: "1:788454456705:web:88ffe1a0a64c785468fc80",
        measurementId: "G-6TSVFW3X73"
      };
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
    </script>
</head>

<body>

    <!--=========== Loader =============-->
    <div id="loading-spinner" class="loading-spinner">
        <div class="spinner"></div>
    </div>

    <!-- Log-in  -->
    <section class="position-relative pb-0">
        <div class="gen-login-page-background" style="background-image: url('images/background/asset-54.jpg');"></div>
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="text-center">
                        <form name="pms_login" id="pms_login" action="#" method="post">
                            <h4>Sign In</h4>
                            <!-- div ->
                            <p class="login-username">
                                <label for="user_login">Email</label>
                                <input type="email" name="log" id="user_login" class="input" value="" size="20" required>
                            </p>
                            <p class="login-password">
                                <label for="user_pass">Password</label>
                                <input type="password" name="pwd" id="user_pass" class="input" value="" size="20" required>
                            </p>
                            <p class="login-remember">
                                <label></label>
                            </p>
                            <p class="login-submit">
                                <input type="submit" name="wp-submit" id="wp-submit" class="button button-primary"
                                    value="Log In">
                                <input type="hidden" name="redirect_to">
                            </p>
                            </div -->
                            <!-- Social Login Divider -->
                            
                            
                            <!-- Social Login Buttons -->
                            <div class="gen-social-login">
                                <button type="button" id="googleLogin" class="gen-social-btn google-btn">
                                    <i class="fab fa-google"></i> Continue with Google
                                </button>
                                <button type="button" id="facebookLogin" class="gen-social-btn facebook-btn">
                                    <i class="fab fa-facebook-f"></i> Continue with Facebook
                                </button>
                                <button type="button" id="phoneLogin" class="gen-social-btn phone-btn">
                                    <i class="fas fa-mobile-alt"></i> Continue with Phone
                                </button>
                            </div>
                            
                            <input type="hidden" name="pms_login" value="1">
                            <input type="hidden" name="pms_redirect">
                            <!--div class="gen-login-links">
                                <a href="register.html">Create Account</a>
                                <span class="divider">|</span>
                                <a href="recover-password.html">Forgot Password?</a>
                            </div -->
                            <div id="firebase-error" style="color: red; margin-top: 10px;"></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Back-to-Top start -->
    <div id="back-to-top">
        <a class="top" id="top" href="#top"> <i class="ion-ios-arrow-up"></i> </a>
    </div>
    <!-- Back-to-Top end -->

    <!-- js-min -->
    <script src="js/jquery-3.6.0.min.js"></script>
    <script src="js/asyncloader.min.js"></script>
    <!-- JS bootstrap -->
    <script src="js/bootstrap.min.js"></script>
    <!-- owl-carousel -->
    <script src="js/owl.carousel.min.js"></script>
    <!-- counter-js -->
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.counterup.min.js"></script>
    <!-- popper-js -->
    <script src="js/popper.min.js"></script>
    <script src="js/swiper-bundle.min.js"></script>
    <!-- Iscotop -->
    <script src="js/isotope.pkgd.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/slick.min.js"></script>
    <script src="js/streamlab-core.js"></script>
    <script src="js/script.js"></script>

    <style>
        /* Social Login Styles that match your theme */
        .gen-social-divider {
            margin: 20px 0;
            position: relative;
            text-align: center;
        }
        .divider-text {
            background: rgba(0,0,0,0.7);
            padding: 0 15px;
            position: relative;
            color: #fff;
            font-size: 14px;
        }
        .gen-social-divider:before {
            content: "";
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: rgba(255,255,255,0.2);
            z-index: -1;
        }
        .gen-social-login {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }
        .gen-social-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .gen-social-btn i {
            margin-right: 10px;
            font-size: 16px;
        }
        .google-btn {
            background: #DB4437;
            color: white;
        }
        .facebook-btn {
            background: #3b5998;
            color: white;
        }
        .phone-btn {
            background: #25D366;
            color: white;
        }
        .gen-social-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        .gen-login-links {
            margin-top: 15px;
            color: #fff;
        }
        .gen-login-links a {
            color: #f8f9fa;
            text-decoration: none;
            transition: color 0.3s;
        }
        .gen-login-links a:hover {
            color: #00a8ff;
        }
        .divider {
            margin: 0 10px;
            color: rgba(255,255,255,0.5);
        }
    </style>

   <script>
// Firebase Providers
const googleProvider = new firebase.auth.GoogleAuthProvider();
const facebookProvider = new firebase.auth.FacebookAuthProvider();

// ========================
// AUTHENTICATION HANDLERS
// ========================

// Universal login success handler
function handleLoginSuccess(user) {
  // Set secure HTTP-only cookie via server-side (recommended)
  // Fallback to client-side cookie if needed
  document.cookie = `mosworks_uid=${user.uid}; max-age=${60*60*24}; path=/; Secure; SameSite=Strict`;
  localStorage.setItem('fbauth', 'true');
  
  // Redirect to library
  setTimeout(() => {
    window.location.href = "movies-infinite-scroll.html";
  }, 500);
}

// Email/Password Login
document.getElementById("pms_login").addEventListener("submit", function(e) {
  e.preventDefault();
  const spinner = document.getElementById("loading-spinner");
  const errorEl = document.getElementById("firebase-error");
  
  spinner.style.display = "flex";
  errorEl.textContent = "";

  auth.signInWithEmailAndPassword(
    document.getElementById("user_login").value,
    document.getElementById("user_pass").value
  )
  .then((userCred) => handleLoginSuccess(userCred.user))
  .catch((error) => {
    spinner.style.display = "none";
    errorEl.textContent = 
      error.code === "auth/user-not-found" ? "Account not found" :
      error.code === "auth/wrong-password" ? "Incorrect password" :
      "Login failed. Please try again";
  });
});

// Google Login
document.getElementById("googleLogin").addEventListener("click", function() {
  const spinner = document.getElementById("loading-spinner");
  const errorEl = document.getElementById("firebase-error");
  
  spinner.style.display = "flex";
  errorEl.textContent = "";

  auth.signInWithPopup(googleProvider)
    .then((result) => handleLoginSuccess(result.user))
    .catch((error) => {
      spinner.style.display = "none";
      errorEl.textContent = error.message.includes("popup") 
        ? "Popup blocked. Please allow popups to login." 
        : error.message;
    });
});

// Facebook Login
document.getElementById("facebookLogin").addEventListener("click", function() {
  const spinner = document.getElementById("loading-spinner");
  const errorEl = document.getElementById("firebase-error");
  
  spinner.style.display = "flex";
  errorEl.textContent = "";

  auth.signInWithPopup(facebookProvider)
    .then((result) => handleLoginSuccess(result.user))
    .catch((error) => {
      spinner.style.display = "none";
      errorEl.textContent = error.message;
    });
});

// ========================
// SESSION MANAGEMENT
// ========================

// Persistent auth state check
auth.onAuthStateChanged((user) => {
  if (user) {
    // Refresh tokens on page load
    document.cookie = `mosworks_uid=${user.uid}; max-age=${60*60*24}; path=/; Secure; SameSite=Strict`;
    localStorage.setItem('fbauth', 'true');
  } else {
    // Clear all auth traces
    document.cookie = 'mosworks_uid=; max-age=0; path=/';
    localStorage.removeItem('fbauth');
  }
});

// Force logout from all providers
document.getElementById("logoutLink")?.addEventListener("click", function(e) {
  e.preventDefault();
  const spinner = document.getElementById("loading-spinner");
  if (spinner) spinner.style.display = "flex";

  auth.signOut()
    .then(() => {
      // Nuclear option - clear everything
      document.cookie = 'mosworks_uid=; max-age=0; path=/';
      localStorage.clear();
      sessionStorage.clear();
      
      // Force reload to prevent back-button issues
      window.location.replace('index.html');
    })
    .catch((error) => {
      console.error("Logout error:", error);
      window.location.href = 'index.html';
    });
});

// ========================
// VIDEO ACCESS PROTECTION
// ========================

// Client-side protection (for GitHub Pages/local testing)
function checkVideoAccess() {
  if (!localStorage.getItem('fbauth') && 
      !document.cookie.includes('mosworks_uid')) {
    window.location.href = 'log-in.html';
  }
}

// Run check on video pages
if (window.location.pathname.includes('movies-infinite-scroll')) {
  checkVideoAccess();
}
</script>
</body>
</html>
